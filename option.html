<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>CyberBall</title>
		<link rel="stylesheet" href="styles/game.css" />
		<style>
			* {
				text-align: center;
			}

			#game-page {
				width: 100%;
				display: grid;
				grid-template-rows: 1fr 2fr 1fr;
				justify-items: center;
				align-items: center;
				text-align: center;
			}

			.players-wrap {
				display: grid;
				grid-template-columns: 1fr 1fr 1fr 1fr;
				grid-template-rows: 1fr 1fr 1fr;
				align-items: center;
			}

			.player-img {
				width: 6rem;
			}
		</style>
	</head>
	<body>
		<div class="game-canvas">
			<div class="canvas-wrap">
				<div id="game-page">
					<h1>CyberBall</h1>
					<div class="players-wrap">
						<!-- <single-player-wrap
							v-for="playerX in player.list"
							:pos="playerX"
							:key="playerX.id"
						></single-player-wrap> -->

						<div :style="gridArea[1]" v-show="player.show[1]">
							<img class="player-img" src="Images/Cyberboy/idle-right.png" />
							<p class="display-names">{{ playerName[1] }}</p>
						</div>
						<div :style="gridArea[2]" v-show="player.show[2]">
							<img class="player-img" src="Images/Cyberboy/idle-right.png" />
							<p class="display-names">{{ playerName[2] }}</p>
						</div>
						<div :style="gridArea[3]" v-show="player.show[3]">
							<img class="player-img" src="Images/Cyberboy/idle-right.png" />
							<p class="display-names">{{ playerName[3] }}</p>
						</div>
						<div :style="gridArea[4]" v-show="player.show[4]">
							<img class="player-img" src="Images/Cyberboy/idle-right.png" />
							<p class="display-names">{{ playerName[4] }}</p>
						</div>
						<div :style="gridArea[5]" v-show="player.show[5]">
							<img class="player-img" src="Images/Cyberboy/idle-right.png" />
							<p class="display-names">{{ playerName[5] }}</p>
						</div>
						<div :style="gridArea[6]" v-show="player.show[6]">
							<img class="player-img" src="Images/Cyberboy/idle-right.png" />
							<p class="display-names">{{ playerName[6] }}</p>
						</div>
						<div :style="gridArea[7]" v-show="player.show[7]">
							<img class="player-img" src="Images/Cyberboy/idle-right.png" />
							<p class="display-names">{{ playerName[7] }}</p>
						</div>
						<div :style="gridArea[8]" v-show="player.show[8]">
							<img class="player-img" src="Images/Cyberboy/idle-right.png" />
							<p class="display-names">{{ playerName[8] }}</p>
						</div>
						<div :style="gridArea[0]" v-show="player.show[0]">
							<img class="player-img" src="Images/Cyberboy/idle-right.png" />
							<p class="display-names">player</p>
						</div>
					</div>
					<label>
						请输入玩家数量：
						<input
							type="number"
							v-model="player.num"
							value="3"
							min="3"
							max="9"
						/>
					</label>
				</div>
			</div>
		</div>

		<script src="script/vue.global.prod.js"></script>
		<script>
			const app = Vue.createApp({
				data() {
					return {
						rect: {
							mode1: [
								"3 / 2 / auto / 4",
								"2 / 1",
								"2 / 4",
								"1 / 2 / auto / 4",
								"3 / 3",
								"1 / 3",
								"1 / 1 / 3",
								"1 / 4 / 3",
								"3 / 1 / auto / 3",
							],
							mode2: [
								"3 / 2",
								"2 / 1 / 4",
								"2 / 4 / 4",
								"1 / 2",
								"3 / 3 / auto / 5",
								"1 / 4 / 3",
								"1 / 1 / 3",
								"1 / 4 / 3",
								"3 / 1 / auto / 3",
							],
						},
						player: {
							num: 3,
							show: [true, true, true],
							list: [
								{ id: 0, x: 3, y: "2/4" },
								{ id: 1, x: "2/4", y: 1 },
								{ id: 2, x: "2/4", y: 4 },
							],
						},
					};
				},
				updated() {
					if (!isNaN(this.player.num) && this.player.num) {
						this.initPlayersPos();
					}
				},
				computed: {
					gridArea() {
						return this.getGridArea();
					},
					playerName() {
						return [0, "1", "2", 3, 4, 5, 6, 7, "8"];
					},
				},
				methods: {
					getGridArea() {
						let arr = [];
						let mode2list;
						const modeMap = {
							3: [],
							4: [],
							5: [0],
							6: [0, 3],
							7: [0, 1, 2, 5],
							8: [0, 1, 2, 3],
							9: [1, 2, 3, 4],
						};
						if (!isNaN(this.player.num) && this.player.num) {
							mode2list = modeMap[this.player.num];
						} else {
							mode2list = modeMap["9"];
						}

						for (let i = 0; i < 9; i++) {
							if (mode2list.includes(i)) {
								arr.push({
									"grid-area": this.rect.mode2[i],
								});
							} else {
								arr.push({
									"grid-area": this.rect.mode1[i],
								});
							}
						}
						return arr;
					},
					initPlayersPos() {
						if (!this.checkPlayerNum()) {
							return -1;
						}

						this.hidePlayers();

						for (let i = 0; i < this.player.num; i++) {
							this.addPlayer(i);
						}
					},

					checkPlayerNum() {
						if (this.player.num < 3 || this.player.num > 9) {
							alert("请输入3-9之间的数值！");
							console.log(this.player.num);
							this.player.num < 3
								? (this.player.num = 3)
								: (this.player.num = 9);
							return false;
						} else {
							return true;
						}
					},

					hidePlayers() {
						if (this.player.show.length <= this.player.num) return -1;
						this.player.show = this.player.show.slice(0, this.player.num);
					},

					addPlayer(i) {
						this.player.show[i] = true;
					},
				},

				mounted() {
					this.initPlayersPos();
				},
			});

			app.component("single-player-wrap", {
				props: ["pos"],

				template: `<div :style="gridArea">
        <img
          class="player-img"
          src="Images/Cyberboy/idle-right.png"
        />
        <p class="display-names">AI by vue{{ pos.id }}</p>
      </div>`,
			});

			app.mount("#game-page");
		</script>
	</body>
</html>
