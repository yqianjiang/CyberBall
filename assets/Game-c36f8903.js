import{P as N}from"./PlayerImg-a2d013ad.js";import{_ as m,r as h,o as u,c as y,a as d,n as x,b as w,d as o,t as f,e as D,F as P,f as b,N as S,g as W}from"./index-07d8dca4.js";const R={name:"Player",components:{PlayerImg:N},props:{isLeftWard:Boolean,playerStyle:String,playerName:String},emits:["moveBall","playerLoaded"]};function T(e,r,t,l,s,a){const n=h("PlayerImg");return u(),y("div",null,[d(n,{class:x(t.isLeftWard?"player-leftWard":"player-rightWard"),style:w(t.playerStyle),onClick:r[0]||(r[0]=c=>e.$emit("moveBall")),onLoad:r[1]||(r[1]=c=>e.$emit("playerLoaded"))},null,8,["class","style"]),o("p",null,f(t.playerName),1)])}const M=m(R,[["render",T]]);const k={name:"Ball",props:{posx:Number,posy:Number,moveDur:Number},computed:{ballStyle(){return`transform:translate(${this.posx}vw, ${this.posy}rem); transition: ${this.moveDur}s ease-out`}}};function z(e,r,t,l,s,a){return u(),y("img",{class:"ball",src:D,style:w(a.ballStyle)},null,4)}const A=m(k,[["render",z]]);const I={props:{throwNum:Number,score:Array}},O={class:"score-board"},G=o("p",null,"排行榜：",-1),X={class:"score-row"};function Y(e,r,t,l,s,a){return u(),y("div",O,[o("p",null,"目前球数："+f(t.throwNum),1),G,o("ol",null,[(u(),y(P,null,b(3,n=>o("li",{key:n},[o("div",X,[o("div",null,f(t.score[n-1].player),1),o("div",null,f(t.score[n-1].value),1)])])),64))])])}const E=m(I,[["render",Y]]),V={rect:{mode1:["3 / 2 / auto / 4","2 / 1","2 / 4","1 / 2 / auto / 4","3 / 3","1 / 3","1 / 1 / 3","1 / 4 / 3","3 / 1 / auto / 3"],mode2:["3 / 2","2 / 1 / 4","2 / 4 / 4","1 / 2","3 / 3 / auto / 5","1 / 4 / 3","1 / 1 / 3","1 / 4 / 3","3 / 1 / auto / 3"]},modeMap:{3:[],4:[],5:[0],6:[0,3],7:[0,1,2,5],8:[0,1,2,3],9:[1,2,3,4]}},F=e=>{const r=e.map(t=>t*Math.random());return r.indexOf(Math.max(...r))},H=e=>{const r=[...e],t=[...e];r.sort((n,c)=>c-n);const l=t.indexOf(r[0]);t[l]=void 0;const s=t.indexOf(r[1]);t[s]=void 0;const a=t.indexOf(r[2]);return t[a]=void 0,[l,s,a]},U=e=>new Promise(r=>{setTimeout(r,e)}),p={playerLayout:V,getRandomIdx:F,getTopIdx:H,sleep:U};const B=16,g=67,j=5,q=2e3,v={playerPos:{}},J={components:{ScoreBoard:E,NavButton:S,Player:M,Ball:A},data(){return{score:{throwCounts:0,playerCounts:[0,0,0,0,0,0,0,0,0]},player:{num:4,numInput:4,turnDur:0,filter:"sepia(1) saturate(20)",hue:180,gray:0,name:["player","player1","player2","player3","player4","player5","player6","player7","player8"],isLeftWard:[!1,!1,!0,!1,!0,!0,!1,!0,!1,!0],refs:[]},ball:{pos:[-10,-10],moveDur:0,owner:void 0}}},computed:{scoreRank(){const[e,r,t]=p.getTopIdx(this.score.playerCounts);return[{player:this.player.name[e],value:this.score.playerCounts[e]},{player:this.player.name[r],value:this.score.playerCounts[r]},{player:this.player.name[t],value:this.score.playerCounts[t]}]},playerStyle(){const e=(t,l,s)=>`filter: ${this.player.filter} hue-rotate(${t}deg) grayscale(${l}%); transition:${s}s linear`,r=[e(this.player.hue,this.player.gray,this.player.turnDur)];for(let t=1;t<this.player.num;t++)r.push(e(Math.random()*360,Math.random()*100,0));return r},gridArea(){const e=t=>p.playerLayout.modeMap[this.player.num].includes(t)?`grid-area: ${p.playerLayout.rect.mode2[t]}`:`grid-area: ${p.playerLayout.rect.mode1[t]}`,r=[];for(let t=0;t<this.player.num;t++)r.push(e(t));return r}},methods:{loadConfigs(){this.player.name[0]=this.$store.getters.playerName||this.player.name[0],this.player.hue=this.$store.getters.playerHue||this.player.hue,this.player.gray=this.$store.getters.playerGray||this.player.gray,this.player.num=this.$store.getters.playerNum||this.player.num},scoreCounter(e){this.score.throwCounts++,this.score.playerCounts[e]++},watchWindowResize(){window.addEventListener("resize",()=>{this.updateBallPosOnResize()},!1)},onPlayerTurn(e){const r=e.clientX;for(const t of[0]){const l=this.setPlayerDirection(r,t);if(l===-1)break;if(this.ball.owner==t){const s=l?-g:g;this.shiftBallPos(s,this.player.turnDur)}}},setPlayerRef(e){e&&this.player.refs.push(e.$el.childNodes[0])},setPlayerDirection(e,r){var l;if(!((l=this.player.refs[r])!=null&&l.offsetLeft))return-1;const t=e<this.player.refs[r].offsetLeft;return t==this.player.isLeftWard[r]?-1:(this.player.isLeftWard[r]=t,t)},getPlayerPos(e,r){if(!r&&v.playerPos[e])return v.playerPos[e];const t=this.player.refs[e];if(!t)return console.log("reference error!"),[void 0,void 0];let l=t.getClientRects()[0].left,s=t.getClientRects()[0].top;return v.playerPos[e]=[l,s],[l,s]},getReceptorId(e){const r=(t=>{const l=[];for(let s=0;s<t;s++){l.push([]);for(let a=0;a<t;a++)s==a?l[s].push(0):l[s].push(1/(t-1))}return l})(this.player.num);return p.getRandomIdx(r[e])},getBallDx(e){let r=g;return this.player.isLeftWard[e]&&(r=0),r},onThrowBall(e){this.ball.owner==0&&this.throwBall(e)},async aiThrowBall(){const e=this.getReceptorId(this.ball.owner);await p.sleep(q),this.throwBall(e)},throwBall(e=0,r=.5){if(this.ball.moveDur=r,e==this.ball.owner)return"don't need to move the ball";this.setBallPos(e),this.ball.owner=e,this.scoreCounter(e),this.ball.owner>0&&this.aiThrowBall()},setBallPos(e,r=!1){const t=this.getBallDx(e),[l,s]=this.getPlayerPos(e,r);if(!l||!s)return;const a=(l+t)/(window.innerWidth/100),n=(s-j)/B;this.ball.pos=[a,n]},resetBallPos(){this.ball.pos=[50-32/2/(window.innerWidth/100),(window.innerHeight-32)/B/2]},updateBallPosOnResize(){this.ball.moveDur=0,this.ball.owner||this.resetBallPos(),this.setBallPos(this.ball.owner,!0)},shiftBallPos(e,r){this.ball.moveDur=r,this.ball.pos[0]+=e/(window.innerWidth/100)}},mounted(){this.loadConfigs(),this.watchWindowResize()},beforeUpdate(){this.player.refs=[]}},K={class:"game-page"},Q=o("h1",null,"CyberBall",-1),Z={class:"main-page"},ee={id:"menu-btn"};function te(e,r,t,l,s,a){const n=h("Player"),c=h("Ball"),L=h("ScoreBoard"),$=h("NavButton");return u(),y("div",K,[Q,o("div",Z,[o("div",{class:"players-wrap",onMousemove:r[0]||(r[0]=(..._)=>a.onPlayerTurn&&a.onPlayerTurn(..._))},[(u(!0),y(P,null,b(a.gridArea,(_,i)=>(u(),W(n,{key:i,ref_for:!0,ref:a.setPlayerRef,style:w(_),playerStyle:a.playerStyle[i],playerName:s.player.name[i],isLeftWard:s.player.isLeftWard[i],title:`分数：${s.score.playerCounts[i]}`,onMoveBall:C=>a.onThrowBall(i),onPlayerLoaded:C=>i===0?a.throwBall(0,0):null},null,8,["style","playerStyle","playerName","isLeftWard","title","onMoveBall","onPlayerLoaded"]))),128))],32)]),d(c,{posx:s.ball.pos[0],posy:s.ball.pos[1],moveDur:s.ball.moveDur},null,8,["posx","posy","moveDur"]),d(L,{throwNum:s.score.throwCounts,score:a.scoreRank},null,8,["throwNum","score"]),o("div",ee,[d($,{destination:"/",text:"返回"})])])}const le=m(J,[["render",te]]);export{le as default};
